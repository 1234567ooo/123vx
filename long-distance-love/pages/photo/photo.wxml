<!--pages/photo/photo.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <text class="header-title">æˆ‘ä»¬çš„ç›¸å†Œ</text>
    <text class="header-subtitle">çè—æ¯ä¸€ä¸ªç¾å¥½ç¬é—´</text>
  </view>

  <!-- ç›¸å†Œåˆ†ç±» -->
  <view class="category-tabs">
    <view class="tab-item {{currentTab === 'all' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="all">
      <text class="tab-text">å…¨éƒ¨</text>
    </view>
    <view class="tab-item {{currentTab === 'selfie' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="selfie">
      <text class="tab-text">è‡ªæ‹</text>
    </view>
    <view class="tab-item {{currentTab === 'together' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="together">
      <text class="tab-text">åˆç…§</text>
    </view>
    <view class="tab-item {{currentTab === 'gift' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="gift">
      <text class="tab-text">ç¤¼ç‰©</text>
    </view>
  </view>

  <!-- ç…§ç‰‡ç½‘æ ¼ -->
  <scroll-view class="photo-grid" scroll-y="true" refresher-enabled="true" bindrefresherrefresh="onRefresh">
    <view class="grid-container">
      <view class="photo-item" 
            wx:for="{{filteredPhotos}}" 
            wx:key="id" 
            bindtap="previewPhoto" 
            data-index="{{index}}">
        <image class="photo-image" 
               src="{{item.url}}" 
               mode="aspectFill" 
               lazy-load="true"></image>
        <view class="photo-overlay">
          <view class="photo-info">
            <text class="photo-date">{{item.dateText}}</text>
            <text class="photo-category">{{item.categoryText}}</text>
          </view>
          <view class="photo-actions">
            <view class="action-btn" bindtap="likePhoto" data-id="{{item.id}}" catchtap="true">
              <text class="action-icon {{item.isLiked ? 'liked' : ''}}">{{item.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- æ·»åŠ ç…§ç‰‡æŒ‰é’® -->
      <view class="add-photo-btn" bindtap="addPhoto">
        <text class="add-icon">ğŸ“·</text>
        <text class="add-text">æ·»åŠ ç…§ç‰‡</text>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredPhotos.length === 0}}">
      <text class="empty-icon">ğŸ“¸</text>
      <text class="empty-text">è¿˜æ²¡æœ‰ç…§ç‰‡å“¦</text>
      <text class="empty-tip">ç‚¹å‡»æ·»åŠ æŒ‰é’®ä¸Šä¼ ç¬¬ä¸€å¼ ç…§ç‰‡å§</text>
    </view>
  </scroll-view>
</view>

<!-- æ·»åŠ ç…§ç‰‡æ¨¡æ€æ¡† -->
<view class="add-modal" wx:if="{{showAddModal}}">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">æ·»åŠ ç…§ç‰‡</text>
      <view class="modal-close" bindtap="closeAddModal">
        <text class="close-icon">âœ•</text>
      </view>
    </view>
    
    <view class="modal-body">
      <!-- ç…§ç‰‡é¢„è§ˆ -->
      <view class="photo-preview" wx:if="{{newPhoto.url}}">
        <image class="preview-image" src="{{newPhoto.url}}" mode="aspectFit"></image>
      </view>
      
      <!-- é€‰æ‹©ç…§ç‰‡ -->
      <view class="photo-selector" wx:if="{{!newPhoto.url}}">
        <view class="selector-btn" bindtap="chooseFromAlbum">
          <text class="selector-icon">ğŸ–¼ï¸</text>
          <text class="selector-text">ä»ç›¸å†Œé€‰æ‹©</text>
        </view>
        <view class="selector-btn" bindtap="takePhoto">
          <text class="selector-icon">ğŸ“·</text>
          <text class="selector-text">æ‹ç…§</text>
        </view>
      </view>
      
      <!-- ç…§ç‰‡ä¿¡æ¯ -->
      <view class="photo-form" wx:if="{{newPhoto.url}}">
        <view class="input-group">
          <text class="input-label">ç…§ç‰‡æè¿°</text>
          <input class="input-field" 
                 placeholder="ä¸ºè¿™å¼ ç…§ç‰‡å†™ä¸ªæè¿°å§" 
                 value="{{newPhoto.description}}" 
                 bindinput="onDescriptionInput"/>
        </view>
        
        <view class="input-group">
          <text class="input-label">åˆ†ç±»</text>
          <view class="category-selector">
            <view class="category-option {{newPhoto.category === item.value ? 'selected' : ''}}" 
                  wx:for="{{categories}}" 
                  wx:key="value" 
                  bindtap="selectCategory" 
                  data-category="{{item.value}}">
              <text class="category-icon">{{item.icon}}</text>
              <text class="category-name">{{item.name}}</text>
            </view>
          </view>
        </view>
        
        <view class="input-group">
          <text class="input-label">æ‹æ‘„æ—¥æœŸ</text>
          <picker mode="date" 
                  end="{{today}}" 
                  value="{{newPhoto.date}}" 
                  bindchange="onDateChange">
            <view class="date-picker">
              <text class="date-text">{{newPhoto.date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</text>
              <text class="picker-arrow">ğŸ“…</text>
            </view>
          </picker>
        </view>
      </view>
    </view>
    
    <view class="modal-footer" wx:if="{{newPhoto.url}}">
      <button class="btn-secondary" bindtap="closeAddModal">å–æ¶ˆ</button>
      <button class="btn-primary" bindtap="savePhoto">ä¿å­˜</button>
    </view>
  </view>
</view>

<!-- ç…§ç‰‡è¯¦æƒ…æ¨¡æ€æ¡† -->
<view class="detail-modal" wx:if="{{showDetailModal}}">
  <view class="detail-content">
    <view class="detail-header">
      <view class="detail-close" bindtap="closeDetailModal">
        <text class="close-icon">âœ•</text>
      </view>
    </view>
    
    <swiper class="photo-swiper" 
            current="{{currentPhotoIndex}}" 
            bindchange="onSwiperChange"
            indicator-dots="{{filteredPhotos.length > 1}}"
            indicator-color="rgba(255,255,255,0.5)"
            indicator-active-color="#ff6b9d">
      <swiper-item wx:for="{{filteredPhotos}}" wx:key="id">
        <view class="swiper-item">
          <image class="detail-image" 
                 src="{{item.url}}" 
                 mode="aspectFit" 
                 bindtap="toggleImageInfo"></image>
        </view>
      </swiper-item>
    </swiper>
    
    <!-- ç…§ç‰‡ä¿¡æ¯ -->
    <view class="photo-detail-info {{showImageInfo ? 'show' : ''}}" wx:if="{{currentPhoto}}">
      <view class="detail-info-content">
        <text class="detail-description">{{currentPhoto.description || 'æš‚æ— æè¿°'}}</text>
        <view class="detail-meta">
          <text class="detail-date">{{currentPhoto.fullDate}}</text>
          <text class="detail-category">{{currentPhoto.categoryText}}</text>
        </view>
      </view>
      
      <view class="detail-actions">
        <view class="action-item" bindtap="likePhoto" data-id="{{currentPhoto.id}}">
          <text class="action-icon {{currentPhoto.isLiked ? 'liked' : ''}}">{{currentPhoto.isLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="action-text">{{currentPhoto.isLiked ? 'å·²å–œæ¬¢' : 'å–œæ¬¢'}}</text>
        </view>
        <view class="action-item" bindtap="sharePhoto">
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </view>
        <view class="action-item" bindtap="deletePhoto" data-id="{{currentPhoto.id}}">
          <text class="action-icon">ğŸ—‘ï¸</text>
          <text class="action-text">åˆ é™¤</text>
        </view>
      </view>
    </view>
  </view>
</view>